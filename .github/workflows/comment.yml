name: pr-build

on:
  issue_comment:
    types: [created]

jobs:
  trigger:
    runs-on: ubuntu-latest
    # Only run on pull-request comments
    if: ${{ github.event.issue.pull_request && github.event.comment.body == '/build-pr-image' }}

    steps:
      - id: get-ref
        run: |
          echo pr=${{ github.event.issue.number }} >> $GITHUB_OUTPUT
          echo ref=ref/pulls/${{ github.event.issue.number }}/head >> $GITHUB_OUTPUT

      - name: Trigger CI workflow
        uses: ./.github/workflows/ci.yml
        with:
          pr: ${{ steps.get-ref.outputs.pr }}
          ref: ${{ steps.get-ref.outputs.ref }}
